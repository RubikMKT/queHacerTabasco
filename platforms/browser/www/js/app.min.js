function details(e){facebookConnectPlugin.getLoginStatus(function(e){"connected"==e.status?facebookConnectPlugin.api("/"+e.authResponse.userID+"?fields=id,name,email,location,birthday,gender",[],function(t){var n=null;if(t.birthday){var o=(new Date).getFullYear(),a=t.birthday.split("/");n=parseInt(o)-parseInt(a[2])}else n="18";t.location?locationCity=t.location.name:locationCity="sin locación",t.gender?genero=t.gender:genero="male",data={email:""+t.email,idUserFacebook:""+e.authResponse.userID,name:""+t.name,age:""+n,gender:""+genero,locations:""+locationCity},axios.post("http://165.227.111.118/api/user/createUserApp",data).then(function(e){btnLogin.style.display="none",idFacebook=e.idFacebook}).catch(function(e){window.plugins.toast.show("Error de conexión","short","center")})},function(e){}):window.plugins.toast.show("No logueado","short","center")})}function onOffline(){callDB(),window.plugins.toast.show("Sin conexion a internet","long","center")}function onOnline(){onDeviceReady()}function callDB(){(db=window.sqlitePlugin.openDatabase({name:"quehacer.db",location:"default"})).transaction(populateDB,errorDB,callSuccessCB)}function callSuccessCB(){window.sqlitePlugin.openDatabase({name:"quehacer.db",location:"default"}).transaction(queryDB,errorDB)}function onDeviceReady(){(db=window.sqlitePlugin.openDatabase({name:"quehacer.db",location:"default"})).transaction(populateDB,errorDB,successCB),getCategory()}function getCategory(){axios.get("http://165.227.111.118/api/user/getCategorias").then(function(e){categories=e.data,categoryElement.innerHTML=templateCategory(e)})}function populateDB(e){e.executeSql("CREATE TABLE IF NOT EXISTS PUBLICIDAD (id INTEGER PRIMARY KEY, name, ubicacion, resena, categoria, precio, horario, telefono, imagen,a, e, s)")}function successCB(){window.sqlitePlugin.openDatabase({name:"quehacer.db",location:"default"}).transaction(insertDB,errorDB)}function errorDB(e){window.plugins.toast.show("Error processing SQL","short","center")}function insertDB(e){axios.get("http://165.227.111.118/api/user/getPublicidads").then(function(e){e.data.forEach(function(e){db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO PUBLICIDAD VALUES (?,?,?,?,?,?,?,?,?,?,?,?)",[""+e.id,""+e.cliente.empresa,""+e.ubicacion,""+e.resena,""+e.categoria.name,""+e.categoria.costo,""+e.categoria.horario,""+e.categoria.telefono,""+e.cliente.imagen,""+e.categoria.clima,""+e.categoria.estacionamiento,""+e.categoria.domicilio])},function(e){alert("Transaction ERROR: "+e.message),window.plugins.toast.show("Transaction ERROR","short","center")},function(){db.transaction(queryDB)})})}).catch(function(){alert(error.message+"error"),window.plugins.toast.show("Error","short","center")})}function queryDB(){db.transaction(function(e){var t=null;e.executeSql("SELECT * FROM PUBLICIDAD",[],function(e,n){for(var o={data:[]},a=[],i=null,r=n.rows.length,c=0;c<r;c++)i="http://165.227.111.118/"+n.rows.item(c).imagen.split("../")[2],a.push({id:n.rows.item(c).id,imagen:i,name:n.rows.item(c).name,ubicacion:n.rows.item(c).ubicacion,resena:n.rows.item(c).resena});$.extend(o.data,a),t=Handlebars.templates.listPublicidad,document.getElementById("listPub").innerHTML=t(o)},function(e,t){window.plugins.toast.show("Error","short","center")})})}function renderPublicidad(e){function t(t){data={user_aplication_id:t,publicidad_id:e},axios.post("http://165.227.111.118/api/user/createPublicidadInterest",data).then(function(e){})}axios.get("http://165.227.111.118/api/user/searchUserAppsForFacebook/"+idFacebook).then(function(e){t(idUser=e.data.id)}),axios.get("http://165.227.111.118/api/user/searchPublicidad/"+e).then(function(e){publicidadConten.style.left=0,publicidadConten.innerHTML=templatePublicidad(e),initialize(e.data.mapaLat,e.data.mapaLng),$(".bxslider_pub").bxSlider({mode:"fade",captions:!1,slideWidth:1200,responsive:!0,controls:!1,hideControlOnEnd:!0,auto:!0,speed:400})})}function listPubCat(e){axios.get("http://165.227.111.118/api/user/getPublicidadForCategory/"+e).then(function(e){contentListPubCategory.style.left=0,contentListPubCategory.style.height="100%",contentListPubCategory.innerHTML=templateListPubCategory(e)})}function closeListPubCategory(){contentListPubCategory.innerHTML="",contentListPubCategory.style.height="auto",contentListPubCategory.style.left="100%"}function closePublicidad(e){publicidadConten.style.left="100%",publicidadConten.innerHTML=""}function filtrarCategoria(e,t){return e.filter(function(e){return Object.keys(t).every(function(n){return e[n].toLowerCase().indexOf(t[n].toLowerCase())>-1})})}function closeRecomendacion(e){recomendaciones.style.left="100%",recomendaciones.style.height="auto",recomendaciones.innerHTML=""}function sendComentario(e){var t=document.getElementById("asunto"),n=document.getElementById("comentarios");data={asunto:t.value,mensaje:n.value},""!==t.value&&""!==n.value?axios.post("http://165.227.111.118/api/user/createSugerencia",data).then(function(e){window.plugins.toast.show("Gracias por su comentario","short","center"),t.value="",n.value=""}):window.plugins.toast.show("Favor de llenar todos los campos","short","center")}var btnLogin=document.getElementById("login"),db=null,idFacebook=null,idUser=null,categories=null,templateCategory=Handlebars.templates.category,categoryElement=document.getElementById("category"),templateRecomendaciones=Handlebars.templates.recomendacion,btnSugerencias=document.getElementById("btnSugerencias"),recomendaciones=document.getElementById("recomendaciones"),cleanInput=document.getElementById("cleanInput"),publicidadConten=document.getElementById("publicidad"),templateListPubCategory=Handlebars.templates.listPublicidadCategory,contentListPubCategory=document.getElementById("lisPubCategory"),facebook_btn=document.getElementById("login_facebook"),inputFilter=document.getElementById("search"),templatePublicidad=Handlebars.templates.publicidad,app={initialize:function(){document.addEventListener("deviceready",this.onDeviceReady.bind(this),!1)},onDeviceReady:function(){this.isLogin()},isLogin:function(){facebookConnectPlugin.getLoginStatus(function(e){"connected"==e.status&&(btnLogin.style.display="none",idFacebook=e.authResponse.userID)})}};app.initialize(),facebook_btn.addEventListener("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),facebookConnectPlugin.login(["email","public_profile","user_birthday","user_location"],function(e){window.plugins.toast.show("Login in","short","center"),details()},function(e){window.plugins.toast.show("Error de login"+e,"short","center")})}),document.addEventListener("offline",onOffline,!1),document.addEventListener("online",onOnline,!1),$(".bxslider").bxSlider({mode:"fade",captions:!1,slideWidth:1200,responsive:!0,controls:!1,hideControlOnEnd:!0,auto:!0,speed:400}),Handlebars.registerHelper("splitUrl",function(e){return"http://165.227.111.118/"+e.split("../")[2]}),inputFilter.addEventListener("keyup",function(e,t){var n=JSON.stringify(categories),o=filtrarCategoria(JSON.parse(n),{name:inputFilter.value});data={data:o},categoryElement.innerHTML=templateCategory(data)}),cleanInput.addEventListener("click",function(){inputFilter.value="",data={data:categories},categoryElement.innerHTML=templateCategory(data)}),btnSugerencias.addEventListener("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),recomendaciones.innerHTML=templateRecomendaciones(),recomendaciones.style.left=0,recomendaciones.style.height="100%"});